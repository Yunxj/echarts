
# 概述

接口文档地址https://mvs.gsafetyweixinsupport.cn:1080/swagger-ui/dist/#/login/listMenus
将下方文档路径放入顶部输入框点击Explore按钮即可切换子文档
baseUrl = https://mvs.gsafetyweixinsupport.cn:1080/
每个场景还拼接了各自的commonPath
所有请求需要带2个请求头
```
config.headers['Accept'] = 'application/json';
config.headers['Content-Type'] = 'application/json';
```
上述参数和代理均已封装完毕,具体操作看下方

# 接口js的写法

接口的axios实例均封装在@/api文件夹中,根据不同场景写在不同的js文件中

公共部分已经提交无需更改
```
import request from '@/api/request'
const commonPath = '/mock-daily/'
```

用export function 将接口的实例暴露出去

不带参数的get请求
```
export function getRoomRecord() {
    return request({
        url:commonPath + 'dailyscenes/room-service/room-record',
    })
}
```

带参数的get请求
```
export function getRoomRecord(data) {
    return request({
        url:commonPath + 'dailyscenes/room-service/room-record',
        params:data
    })
}
```

不带参数的post请求
```
export function getRoomRecord() {
    return request({
        url:commonPath + 'dailyscenes/room-service/room-record',
        method:'post'
    })
}
```

带参数的post请求(参数在body中)
```
export function getRoomRecord(data) {
    return request({
        url:commonPath + 'dailyscenes/room-service/room-record',
        method:'post',
        data
    })
}
```

#组件内的写法
script标签顶部写
以下例子中,getRoomRecord为getDailyData.js中暴露的一个接口实例
pollingTime , baseFilePath为配置信息,分别是轮询的时间(毫秒)
```
import {getRoomRecord} from '@/api/getDailyData' 
```

methods内部写 (所有的需要轮询的接口均写在initData内,这里只是举一个例子)
```
async initData() {
    const res = await getRoomRecord()
    console.log(res)
    if (res.code == 200) {
        ...some code 
    }
}
```

created内部写
```
clearInterval(window.timer)
window.timer = setInterval(_=>{
    this.initData()
},pollingTime)
```
每隔一段时间执行一次initData

路由离开钩子,添加清除定时器的代码,请注意不要覆盖原钩子(原钩子中有动画效果的代码)
```
beforeRouteLeave(from,to,next){
    clearInterval(window.timer)  //这里是新增的
    next()
},
```

#国旗图片的计算
1.引入图片计算函数
```
import {pollingTime , baseFilePath} from '@/config/env'
```

2.注入到组件的methods中
```
method:{
    baseFilePath,
    ...other function
}
```

3.将后台表示国旗的字符串当参数传入,即可返回完整链接
```
<img :src="baseFilePath(res.flag)">
```